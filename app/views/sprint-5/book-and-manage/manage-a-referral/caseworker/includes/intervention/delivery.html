{% set items = [] %}
{% set expanded = true %}

{% if viewModel.showInitialAssessment %}
  {% set html %}
  <p class="govuk-body">
  Enter the date of the initial assessment. If it is not scheduled, use the communications tool to contact the probation practitioner online.
  </p>

  {% if viewModel.populateInitialAssessmentContent %}
    {% include "./initial-assessment.html" %}
  {% endif %}
  {% endset %}

  {% set item = { heading: { text: "Initial assessment" }, content: { html: html }, expanded: expanded } %}
  {{ items.push(item) and undefined }}

  {% set expanded = false %}
{% endif %}

{% if viewModel.showActionPlan %}
  {% set html %}
  <p class="govuk-body">
  Create the action plan and submit it to the probation practitioner for approval.
  {% if not viewModel.populateActionPlanContent %}
    Action plans that are ready to be created will appear below when the initial assessment is scheduled.
  {% endif %}
  </p>
  {% if viewModel.populateActionPlanContent %}
    {% include "./action-plan.html" %}
  {% endif %}
  {% endset %}

  {% set item = { heading: { text: "Service user action plan" }, content: { html: html }, expanded: expanded } %}
  {{ items.push(item) and undefined }}

  {% set expanded = false %}
{% endif %}

{% set html = null %}
{% if viewModel.showInterventionSessions %}
  {% set html %}
  <p class="govuk-body">
  Track the progress of each intervention session.
  {% if not viewModel.populateInterventionSessionsContent %}
    Intervention sessions that are ready to be tracked will appear below once the action plan is approved.
  {% endif %}
  </p>
  {% if viewModel.populateInterventionSessionsContent %}
    {% include "./progress.html" %}
  {% endif %}
  {% endset %}

  {% set item = { heading: { text: "Intervention sessions" }, content: { html: html }, expanded: expanded } %}
  {{ items.push(item) and undefined }}

  {% set expanded = false %}
{% endif %}

{% set html = null %}
{% if viewModel.showEndOfServiceReport %}
  {% set html %}
  <p class="govuk-body">
  Complete and submit the end of service report when the service user has met the conditions for this intervention. If the service user has not met the conditions of the intervention the service provider can also terminate and generate an end of service report at any time.
  </p>
  {% if viewModel.populateEndOfServiceReportContent %}
    {% include "./end-of-service-report.html" %}
  {% endif %}
  {% endset %}

  {% set item = { heading: { text: "End of service report" }, content: { html: html }, expanded: expanded } %}
  {{ items.push(item) and undefined }}

  {% set expanded = false %}
{% endif %}

{{ govukAccordion({
  id: ("accordion-intervention-delivery-" + referralIndex + "-" + interventionIndex),
  items: items
}) }}
